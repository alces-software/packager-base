---
:src: qrupdate-1.1.2.tar.gz
:type: libs
:version: '1.1.2'
:compilers:
  gcc:
:compile: |
  # patch the build parameters file to use ATLAS
  patch -p1 <<\EOF
  --- a/Makeconf   2010-01-19 11:35:49.000000000 +0000
  +++ b/Makeconf   2012-05-16 19:17:16.613414906 +0100
  @@ -6,9 +6,9 @@
   FPICFLAGS=-fPIC
   
   # BLAS library (only required for tests)
  -BLAS=-lblas
  +BLAS=-L$(ATLASDIR)/lib -latlas
   # LAPACK library (only required for tests)
  -LAPACK=-llapack
  +LAPACK=-L$(ATLASDIR)/lib -llapack
   
   # Library version
   VERSION=1.1
  EOF
  make lib <%= redirect(:make_lib) %>
  make solib <%= redirect(:make_solib) %>
:install: |
  for a in ChangeLog COPYING README; do
    install -D -m 644 $a <%= dest_dir %>/$a
  done
  install -D -m 644 libqrupdate.a <%= dest_dir %>/lib/libqrupdate.a
  install -D -m 755 libqrupdate.so <%= dest_dir %>/lib/libqrupdate.so.1.1
  ln -s libqrupdate.so.1.1 <%= dest_dir %>/lib/libqrupdate.so
  ln -s libqrupdate.so.1.1 <%= dest_dir %>/lib/libqrupdate.so.1
:module: |
  #%Module1.0#####################################################################
  ##
  ## Alces HPC Software Stack - Library module file
  ## Copyright (c) 2008-2012 Alces Software Ltd
  ##
  ################################################################################
  proc ModulesHelp { } {
          global app
          global version
          global appcaps
          global appdir

          puts stderr "Adds `$app-$version' to your environment variables"
          puts stderr ""
          puts stderr "##############"
          puts stderr "ENV after load"
          puts stderr "##############"
          puts stderr "${appcaps}DIR -> base path of library"
          puts stderr "${appcaps}LIB -> lib path of library"
          puts stderr "Adds ${appcaps}LIB to LD_LIBRARY_PATH"
          puts stderr ""
  }

  set     app      <%= package.name %>
  set     version  <%= version %>
  set     appcaps  <%= package.caps_name %>
  set     appdir   <%= dest_dir %>

  module-whatis   "loads the necessary `$app-$version' setup environment"

  setenv ${appcaps}DIR ${appdir}
  setenv ${appcaps}LIB ${appdir}/lib

  prepend-path LD_LIBRARY_PATH ${appdir}/lib
  

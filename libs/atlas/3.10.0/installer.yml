---
:src: atlas3.10.0.tar.bz2
:src_dir: ATLAS
:type: libs
:version: 3.10.0
:params:
  :cpuspeed: "Specify cpu speed, eg. '2666'"
  :lapackfile: "Specify lapack tarball location"
:compilers:
  gcc:
    :configure_flags: ''
  open64:
    :configure_flags: "-C xc opencc -C ic opencc -C if openf90 -C sk opencc -C dk opencc -C sm opencc -C dm opencc -F xc '-O3 -g -lfortran -lffio -lm' -F ic '-O3 -g -lfortran -lffio -lm' -F if '-O3 -g -lfortran -lffio -lm' -F sk '-O3 -g -lfortran -lffio -lm' -F dk '-O3 -g -lfortran -lffio -lm'  -F sm '-O3 -g -lfortran -lffio -lm' -F dm '-O3 -g -lfortran -lffio -lm'"
:compile: |
  cd <%= src_dir %>
  mkdir build
  cd build
  ../configure <%= compiler[:configure_flags] %> --prefix=<%= dest_dir %> \
    --incdir=<%= File.join(dest_dir,'include') %> \
    --libdir=<%= File.join(dest_dir,'lib') %> \
    --shared -Fa alg -fPIC -b 64 -D c \
    -DPentiumCPS=<%= param(:cpuspeed) %> \
    --with-netlib-lapack-tarfile=<%= param(:lapackfile) %> > >(tee -a alces-configure.log) 2> >(tee -a alces-configure.log >&2)
  make > >(tee -a alces-make.log) 2> >(tee -a alces-make.log >&2)
  make check > >(tee -a alces-test.log) 2> >(tee -a alces-test.log >&2)
  make ptcheck > >(tee -a alces-test.log) 2> >(tee -a alces-test.log >&2)
  make time > >(tee -a alces-test.log) 2> >(tee -a alces-test.log >&2)
:install: |
  cd <%= File.join(src_dir,'build') %>
  make install > >(tee -a alces-install.log) 2> >(tee -a alces-install.log >&2)
:module: |
  #%Module1.0#####################################################################
  ##
  ## ATLAS module file
  ##
  ################################################################################
  proc ModulesHelp { } {
          global version

          puts stderr "\tAdds `atlas-$version' to your PATH environment variable and necessary libraries"
  }

  set     version <%= version %>

  module-whatis   "loads the necessary `atlas-$version' library paths"

  set ATLAS_DIR <%= dest_dir %>

  setenv           ATLASDIR         $ATLAS_DIR/
  setenv           ATLAS_DIR        $ATLAS_DIR/
  setenv           ATLAS_HOME       $ATLAS_DIR/

  setenv           ATLASINCLUDE     $ATLAS_DIR/include
  setenv           ATLASLIB         $ATLAS_DIR/lib
  setenv           ATLAS_LIB        $ATLAS_DIR/lib
  setenv           ATLAS            $ATLAS_DIR/lib/libatlas.a

  prepend-path LD_LIBRARY_PATH $ATLAS_DIR/lib/
  prepend-path LD_INCLUDE_PATH $ATLAS_DIR/include/
  prepend-path CPP_INCLUDE_PATH $ATLAS_DIR/include/
  prepend-path C_INCLUDE_PATH $ATLAS_DIR/include/

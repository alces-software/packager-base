---
:src: scalapack-2.0.2.tgz
:type: libs
:version: '2.0.2'
:compilers:
  gcc:
    :configure_env: ''
  intel:
    :configure_env: 'CC=icc CXX=icpc F77=ifort FC=ifort F90=ifort'
  open64:
    :configure_env: 'CC=opencc CXX=openCC F77=openf90 FC=openf90 F90=openf90'
:variants:
  static:
    :cmake_parameters: '-DBUILD_STATIC_LIBS=ON -DLAPACK_LIBRARIES="$ATLASLIB/liblapack.a;$ATLASLIB/libf77blas.so" -DBLAS_LIBRARIES="$ATLASLIB/libcblas.a;$ATLASLIB/libatlas.a"'
  shared:
    :cmake_parameters: '-DBUILD_SHARED_LIBS=ON -DLAPACK_LIBRARIES="$ATLASLIB/liblapack.so;$ATLASLIB/libf77blas.so" -DBLAS_LIBRARIES="$ATLASLIB/libcblas.so;$ATLASLIB/libatlas.so"'
:compile: |
  mkdir build
  cd build
  <%= compiler[:configure_env] %> cmake <%= variant[:cmake_parameters] %> -DCMAKE_INSTALL_PREFIX:PATH=<%= dest_dir %> .. <%= redirect(:configure) %>
  make <%= redirect(:compile) %>
:install: |
  cd build
  make install <%= redirect(:install) %>
:module: |
  #%Module1.0#####################################################################
  ##
  ## Alces HPC Software Stack - Library module file
  ## Copyright (c) 2008-2012 Alces Software Ltd
  ##
  ################################################################################
  proc ModulesHelp { } {
          global app
          global version
          global appcaps
          global appdir

          puts stderr "Adds `$app-$version' to your environment variables"
          puts stderr ""
          puts stderr "##############"
          puts stderr "ENV after load"
          puts stderr "##############"
          puts stderr "${appcaps}DIR -> base path of library"
          puts stderr "${appcaps}LIB -> lib path of app"
          <% if variant_name == 'shared' %>
          puts stderr "Adds ${appcaps}LIB to LD_LIBRARY_PATH"
          <% end %>
          puts stderr "Adds ${appcaps}/lib/pkgconfig to PKG_CONFIG_PATH"
          puts stderr ""
  }

  prereq mpi/<%= compiler_name %>/openmpi

  set     app      <%= package.name %>
  set     version  <%= version %>
  set     appcaps  <%= package.caps_name %>
  set     appdir   <%= dest_dir %>

  module-whatis   "loads the necessary `$app-$version' setup environment"

  setenv ${appcaps}DIR ${appdir}
  setenv ${appcaps}LIB ${appdir}/lib

  prepend-path PKG_CONFIG_PATH ${appdir}/lib/pkgconfig
  <% if variant_name == 'shared' %>
  prepend-path LD_LIBRARY_PATH ${appdir}/lib
  <% end %>
---
:schema: 1
:title: METIS
:license: NONFREE - Free for use for educational and research purposes by non-profit institutions; see doc/LICENSE.txt
:summary: Serial Graph Partitioning and Fill-reducing Matrix Ordering
:url: http://glaros.dtc.umn.edu/gkhome/metis/metis/overview
:description: |
  METIS is a set of serial programs for partitioning graphs,
  partitioning finite element meshes, and producing fill reducing
  orderings for sparse matrices. The algorithms implemented in METIS
  are based on the multilevel recursive-bisection, multilevel k-way,
  and multi-constraint partitioning schemes developed in the Karypis
  Lab.
:group: Mathematics
:changelog: |
  * Fri Mar 10 2023 - Rob Brown <rob.brown@alces-flight.com>
    - Updated to v5.1.0
  * Wed Nov 21 2012 - Mark J. Titorenko <mark.titorenko@alces-software.com>
    - First created
:src: metis-5.1.0.tar.gz
:src_dir: METIS-1-e1c0806d73e44be5bdc0bec1c78fc6dbfc9c75db
:type: libs
:version: '5.1.0'
:requirements:
  :tool: apps/cmake
:variants:
  default:
    :width: '32'
  '64':
    :width: '64'
:compilers:
  gcc:
    :make_flags: ''
  intel:
    :make_flags: 'CC=icc CPP="icpc -E" FC=ifort F77=ifort F90=ifort CXX=icpc CFLAGS="-O3 -march=core-avx2 -fma -ftz -fomit-frame-pointer -fPIC" FCFLAGS="-O3 -march=core-avx2 -align array64byte -fma -ftz -fomit-frame-pointer" FFLAGS="-O3 -march=core-avx2 -align array64byte -fma -ftz -fomit-frame-pointer" CXXFLAGS="-O3 -march=core-avx2"'
:compile: |
  cd metis-5.1.0
  sed -i -e 's/#define IDXTYPEWIDTH 32/#define IDXTYPEWIDTH <%= variant[:width] %>/g' include/metis.h
  #make config <%= compiler[:make_flags] %> shared=1 prefix=<%= dest_dir %> <%= redirect(:configure) %>
  make config <%= compiler[:make_flags] %> prefix=<%= dest_dir %> <%= redirect(:configure) %>
  make <%= redirect(:compile) %>
:install: |
  cd metis-5.1.0
  make install <%= redirect(:install) %>
  mkdir <%= dest_dir %>/doc
  #mv <%= dest_dir %>/lib/libmetis.so <%= dest_dir %>/lib/libmetis.so.0
  #ln -s libmetis.so.0 <%= dest_dir %>/lib/libmetis.so
  cp -av manual/manual.pdf LICENSE.txt Changelog <%= dest_dir %>/doc <%= redirect(:install) %> 
  cp -av graphs <%= dest_dir %> <%= redirect(:install) %>
:module: |
  setenv ${appcaps}DIR ${appdir}
  setenv ${appcaps}LIB ${appdir}/lib
  setenv ${appcaps}BIN ${appdir}/bin
  setenv ${appcaps}DOC ${appdir}/doc
  setenv ${appcaps}INCLUDE ${appdir}/include

  prepend-path LD_LIBRARY_PATH ${appdir}/lib
  prepend-path PATH ${appdir}/bin


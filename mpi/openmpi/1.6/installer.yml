---
:src: openmpi-1.6.tar.bz2
:type: mpi
:version: '1.6'
:compilers:
  gcc:
    :configure_flags: ''
  intel:
    :configure_flags: 'CC=icc CXX=icpc F77=ifort FC=ifort F90=ifort'
  open64:
    :configure_flags: 'CC=opencc CXX=openCC F77=openf90 FC=openf90 F90=openf90'
:params:
  :qlogic: "Specify whether to use Qlogic Infinipath PSM libs [true|false]"
:sources:
  - examples.sge.openmpi.template
:compile: |
  ./configure --with-sge <%= '--with-psm' if param(:qlogic) == 'true' %> --prefix=<%= dest_dir %> <%= compiler[:configure_flags] %> <%= redirect(:configure) %>
  make <%= redirect(:make) %>
:install: |
  make install <%= redirect(:install) %>
  install -D -m 644 <%= source("examples.sge.openmpi.template") %> <%= dest_dir %>/examples/sge/openmpi.template
:module: |
  #%Module1.0#####################################################################
  ##
  ## openmpi module file
  ##
  ################################################################################
  proc ModulesHelp { } {
          global version
  
          puts stderr "\tAdds `openmpi-$version' to your PATH environment variable and necessary libraries"
  }
  
  set     version <%= version %>

  module-whatis   "loads the necessary `openmpi-$version' library paths"

  # Enable the following two options to force openmpi to operate over
  # ethernet even if an InfiniBand card is detected.  This can be
  # useful if you are trying to diagnose a potential problem with your
  # IB fabric.
  # setenv OMPI_MCA_btl_tcp_if_include eth0
  # setenv OMPI_MCA_btl tcp,self

  # Enable the following if you are running jobs that span more than
  # 128 nodes.  Adjust '512' to match the maximum number of nodes your
  # jobs will span (which would usually be the number of nodes in your
  # cluster).
  # setenv OMPI_MCA_plm_rsh_num_concurrent 512

  set MPI_DIR <%= dest_dir %>

  setenv MPI_HOME $MPI_DIR

  prepend-path PATH $MPI_DIR/bin/
  prepend-path LD_LIBRARY_PATH $MPI_DIR/lib/
  prepend-path MANPATH $MPI_DIR/share/man/

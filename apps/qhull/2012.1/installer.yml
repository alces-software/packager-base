---
:src: qhull-2012.1-src.tgz
:type: apps
:version: '2012.1'
:compilers:
  gcc:
:compile: |
  # patch the Makefile to addd -fno-strict-aliasing
  patch -p1 <<\EOF
  --- a/Makefile     2012-02-20 02:55:57.000000000 +0000
  +++ b/Makefile     2012-05-16 14:27:57.504411338 +0100
  @@ -87,11 +87,11 @@
   
   #for Gnu's gcc compiler, -O2 for optimization, -g for debugging
   CC        = gcc
  -CC_OPTS1  = -O2 -fPIC -ansi -Isrc/libqhull $(CC_WARNINGS)
  +CC_OPTS1  = -O2 -fPIC -ansi -Isrc/libqhull -fno-strict-aliasing $(CC_WARNINGS)
   CXX       = g++
   
   # libqhullcpp must be before libqhull
  -CXX_OPTS1 = -O2 -Dqh_QHpointer -Isrc/ -Isrc/libqhullcpp -Isrc/libqhull $(CXX_WARNINGS)
  +CXX_OPTS1 = -O2 -fPIC -Dqh_QHpointer -Isrc/ -Isrc/libqhullcpp -Isrc/libqhull -fno-strict-aliasing $(CXX_WARNINGS)
   
   # for shared library link
   CC_OPTS3  =
  EOF
  make <%= redirect(:make) %>
:install: |
  make install BINDIR=<%=dest_dir%>/bin INCDIR=<%=dest_dir%>/include LIBDIR=<%=dest_dir%>/lib DOCDIR=<%=dest_dir%>/share/doc/qhull MANDIR=<%=dest_dir%>/share/man/man1 <%= redirect(:install) %>
:module: |
  #%Module1.0#####################################################################
  ##
  ## Alces HPC Software Stack - Application module file
  ## Copyright (c) 2008-2012 Alces Software Ltd
  ##
  ################################################################################
  proc ModulesHelp { } {
          global app
          global version
          global appcaps
          global appdir

          puts stderr "Adds `$app-$version' to your environment variables"
          puts stderr ""
          puts stderr "##############"
          puts stderr "ENV after load"
          puts stderr "##############"
          puts stderr "${appcaps}DIR -> base path of app"
          puts stderr "${appcaps}BIN -> bin path of app"
          puts stderr "${appcaps}LIB -> lib path of app"
          puts stderr "${appcaps}INCLUDE -> include path of app"
          puts stderr "Adds ${appcaps}LIB to LD_LIBRARY_PATH"
          puts stderr "Adds ${appcaps}BIN to PATH"
          puts stderr "Adds ${appcaps}DIR/share/man to MANPATH"
          puts stderr ""
  }

  set     app      <%= package.name %>
  set     version  <%= version %>
  set     appcaps  <%= package.caps_name %>
  set     appdir   <%= dest_dir %>

  module-whatis   "loads the necessary `$app-$version' setup environment"

  setenv ${appcaps}DIR ${appdir}
  setenv ${appcaps}BIN ${appdir}/bin
  setenv ${appcaps}LIB ${appdir}/lib
  setenv ${appcaps}INCLUDE ${appdir}/include

  prepend-path LD_LIBRARY_PATH ${appdir}/lib
  prepend-path PATH ${appdir}/bin
  prepend-path MANPATH ${appdir}/share/man
  

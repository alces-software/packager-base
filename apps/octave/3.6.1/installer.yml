---
:src: octave-3.6.1.tar.bz2
:type: apps
:version: '3.6.1'
:compilers:
  gcc:
:compile: |
  export FFTWF=$(echo $FFTW | sed 's/double/float/')
  
  ./configure --with-qhull-includedir=$QHULLINCLUDE --with-qhull-libdir=$QHULLLIB \
    --with-hdf5-includedir=$HDF5INCLUDE --with-hdf5-libdir=$HDF5LIB \
    --with-fftw3-includedir=$FFTW/include --with-fftw3-libdir=$FFTW/lib \
    --with-fftw3f-includedir=$FFTWF/include --with-fftw3f-libdir=$FFTWF/lib \
    --with-magick=GraphicsMagick \
    --with-blas=$ATLASDIR/lib/libatlas.a \
    --with-lapack=$ATLASDIR/lib/liblapack.a \
    --with-qrupdate-includedir=$QRUPDATEINCLUDE --with-qrupdate-libdir=$QRUPDATELIB \
    --with-amd-includedir=$SUITESPARSEINCLUDE --with-amd-libdir=$SUITESPARSELIB \
    --with-camd-includedir=$SUITESPARSEINCLUDE --with-camd-libdir=$SUITESPARSELIB \
    --with-colamd-includedir=$SUITESPARSEINCLUDE --with-colamd-libdir=$SUITESPARSELIB \
    --with-ccolamd-includedir=$SUITESPARSEINCLUDE --with-ccolamd-libdir=$SUITESPARSELIB \
    --with-cholmod-includedir=$SUITESPARSEINCLUDE --with-cholmod-libdir=$SUITESPARSELIB \
    --with-cxsparse-includedir=$SUITESPARSEINCLUDE --with-cxsparse-libdir=$SUITESPARSELIB \
    --with-umfpack-includedir=$SUITESPARSEINCLUDE --with-umfpack-libdir=$SUITESPARSELIB \
    --with-arpack-libdir=$ARPACK_NGLIB \
    --prefix=<%= dest_dir %> \
    CPPFLAGS=-I$HDF5INCLUDE \
    LDFLAGS="-L$ATLASDIR/lib -L$QRUPDATELIB"
  
  make check <%= redirect(:make) %>
:install: |
  make install <%= redirect(:install) %>
:module: |
  #%Module1.0#####################################################################
  ##
  ## Alces HPC Software Stack - Application module file
  ## Copyright (c) 2008-2012 Alces Software Ltd
  ##
  ################################################################################
  proc ModulesHelp { } {
          global app
          global version
          global appcaps
          global appdir

          puts stderr "Adds `$app-$version' to your environment variables"
          puts stderr ""
          puts stderr "##############"
          puts stderr "ENV after load"
          puts stderr "##############"
          puts stderr "${appcaps}DIR -> base path of library"
          puts stderr "${appcaps}BIN -> bin path of library"
          puts stderr "${appcaps}LIB -> lib path of library"
          puts stderr "Adds ${appcaps}LIB to LD_LIBRARY_PATH"
          puts stderr "Adds ${appcaps}BIN to PATH"
          puts stderr "Adds ${appcaps}DIR/share/man to MANPATH"
          puts stderr "Adds ${appcaps}DIR/share/info to INFOPATH"
          puts stderr ""
  }


  # qhull and arpack-ng are linked into octave with their full paths.
  # only qrupdate is dynamically loaded.
  #prereq apps/<%= compiler_name %>/qhull
  #prereq libs/<%= compiler_name %>/arpack-ng
  prereq libs/<%= compiler_name %>/qrupdate 

  set     app      <%= package.name %>
  set     version  <%= version %>
  set     appcaps  <%= package.caps_name %>
  set     appdir   <%= dest_dir %>

  module-whatis   "loads the necessary `$app-$version' setup environment"

  setenv ${appcaps}DIR ${appdir}
  setenv ${appcaps}BIN ${appdir}/bin
  setenv ${appcaps}INCLUDE ${appdir}/include/octave-${version}
  setenv ${appcaps}LIB ${appdir}/lib/octave/${version}

  prepend-path LD_LIBRARY_PATH ${appdir}/lib/octave/${version}
  prepend-path PATH ${appdir}/bin
  prepend-path MANPATH ${appdir}/share/man
  prepend-path INFOPATH ${appdir}/share/info


---
:src: beast-1.7.1.tgz
:type: apps
:version: '1.7.1'
:compilers:
  gcc:
:compile: |
  # beast core
  ant linux <%= redirect(:ant) %>
  pushd release/Linux/BEASTv<%= version %>/native
  export JAVA_HOME=${JAVA_HOME:-`readlink -f /usr/bin/javac | sed 's/\/bin\/javac//'`}
  sed -i 's/       /\t/g' Makefile.amd64
  make -f Makefile.amd64
  rm -f *.o
  cd ../lib
  rm -f *.so
  mv ../native/*.so .
  popd

  # phylogeography
  ant -f build_phylogeography.xml package

  # Other ant build files seem not to package anything usefully right
  # now.
:install: |
  mkdir -p <%= dest_dir %>

  # beast core
  cp -r release/Linux/BEASTv<%= version %>/* <%= dest_dir %>
  cp LICENSE NOTIFY <%= dest_dir %>

  # phylogeography
  cp -r release_phylogeography/common/bin/* <%= dest_dir %>/bin
  cp -r release_phylogeography/PhylogeographyTools*/lib/* <%= dest_dir %>/lib
  cp -r plugins_SDK <%= dest_dir %>
:module: |
  #%Module1.0#####################################################################
  ##
  ## Alces HPC Software Stack - Application module file
  ## Copyright (c) 2008-2012 Alces Software Ltd
  ##
  ################################################################################
  proc ModulesHelp { } {
          global app
          global version
          global appcaps
          global appdir

          puts stderr "Adds `$app-$version' to your environment variables"
          puts stderr ""
          puts stderr "##############"
          puts stderr "ENV after load"
          puts stderr "##############"
          puts stderr "${appcaps}DIR -> base path of application"
          puts stderr "${appcaps}BIN -> bin path of application"
          puts stderr "Adds ${appcaps}BIN to PATH"
          puts stderr ""
  }

  set     app      <%= package.name %>
  set     version  <%= version %>
  set     appcaps  <%= package.caps_name %>
  set     appdir   <%= dest_dir %>

  module-whatis   "loads the necessary `$app-$version' setup environment"

  setenv ${appcaps}DIR ${appdir}
  setenv ${appcaps}BIN ${appdir}/bin

  prepend-path LD_LIBRARY_PATH ${appdir}/lib
  prepend-path PATH ${appdir}/bin

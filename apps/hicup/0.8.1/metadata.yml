---
:schema: 1
:title: HiCUP
:license: GPLv3+
:summary: A tool for mapping and performing quality control on Hi-C data
:url: https://deeptools.github.io/
:description: |
  HiCUP is a bioinformatics pipeline for processing Hi-C data. The
  pipeline takes and maps FASTQ data against a reference genome and
  filters out frequently encountered experimental artefacts. The
  pipeline produces paired-read files in SAM/BAM format, each read
  pair corresponding to a putative Hi-C di-tag. HiCUP also produces
  summary statistics at each stage of the pipeline providing quality
  control, helping pinpoint potential problems and refine the
  experimental protocol.
:group: Bioinformatics
:changelog: |
  * Wed May  5 2021 Rob Brown <rob.brown@alces-flight.com>
    - Updated to v0.8.1
  * Mon Mar 26 2018 Mark J. Titorenko <mark.titorenko@alces-software.com>
    - Updated distro dependencies
  * Mon May  8 2017 Mark J. Titorenko <mark.titorenko@alces-software.com>
    - First created
:src: hicup_v0.8.1.tar.gz
:src_dir: HiCUP-0.8.1
:type: apps
:version: '0.8.1'
:requirements:
  :build:
    - apps/bowtie2
    - apps/R >= 3.1.2
    - apps/samtools >= 0.1.18
  :runtime:
    - apps/bowtie2
    - apps/R >= 3.1.2
    - apps/samtools >= 0.1.18
:dependencies:
  el:
    - perl-Data-Dumper
:sources:
  - hicup-wrapper.sh
:compilers:
  noarch:
:compile: |
  # no-op; this is a distribution of a perl application
:install: |
  mkdir -p <%= dest_dir %>/{dist,bin,doc}
  cp -Rv * <%= dest_dir %>/dist
  cp -v <%= source('hicup-wrapper.sh') %> <%= dest_dir %>/bin
  chmod 755 <%= dest_dir %>/bin/hicup-wrapper.sh
  for a in hicup hicup_deduplicator hicup_digester hicup_filter hicup_mapper hicup_reporter hicup_truncater; do
    ln -s hicup-wrapper.sh <%= dest_dir %>/bin/$a
  done
  mv <%= dest_dir %>/dist/Documentation <%= dest_dir %>/doc
  mv <%= dest_dir %>/dist/{README.txt,LICENSE.txt,RELEASE_NOTES.txt} <%= dest_dir %>/doc
  unset R_LIBS_USER
  export R_LIBS_SITE=<%= dest_dir %>/R:${R_LIBS_SITE}
  mkdir -p <%= dest_dir %>/R
  cat <<EOF | R --no-save <%= redirect(:rlibs) %>
  local({r <- getOption("repos"); r["CRAN"] <- "http://cran.ma.imperial.ac.uk"; options(repos=r)})
  install.packages(c('tidyverse','plotly'), "<%= dest_dir %>/R")  
  EOF
:module: |
  setenv ${appcaps}DIR ${appdir}
  setenv ${appcaps}BIN ${appdir}/bin
  setenv ${appcaps}DOC ${appdir}/doc
  setenv ${appcaps}DIST ${appdir}/dist

  prepend-path PATH ${appdir}/bin
  prepend-path PERL5LIB ${appdir}/dist
  prepend-path R_LIBS_SITE ${appdir}/R

---
:license: OTHER - See http://samtools.sourceforge.net/
:summary: Provides various utilities for manipulating alignments in the SAM format, including sorting, merging, indexing and generating alignments in a per-position format
:url: http://samtools.sourceforge.net/
:description: |
  SAM (Sequence Alignment/Map) format is a generic format for storing
  large nucleotide sequence alignments. SAM aims to be a format that:

    * Is flexible enough to store all the alignment information
      generated by various alignment programs
    * Is simple enough to be easily generated by alignment programs or
      converted from existing alignment formats
    * Is compact in file size
    * Allows most of operations on the alignment to work on a stream
      without loading the whole alignment into memory
    * Allows the file to be indexed by genomic position to efficiently
      retrieve all reads aligning to a locus

  SAM Tools provide various utilities for manipulating alignments in
  the SAM format, including sorting, merging, indexing and generating
  alignments in a per-position format.
:group: Bioinformatics
:changelog: |
  * Wed Apr 27 2016 - Ruan G. Ellis <ruan.ellis@alces-software.com>
    - Added distro dependencies for El
  * Tue Mar  3 2014 Mark J. Titorenko <mark.titorenko@alces-software.com>
    - Corrected permissions on installed files
  * Wed Mar  5 2014 James Donohue <james.donohue@alces-software.com>
    - Added example script
  * Thu Oct 24 2013 Mark J. Titorenko <mark.titorenko@alces-software.com>
    - add missing bcftools/vcfutils.pl to bin directory
  * Thu Apr  4 2013 James Donohue <james.donohue@alces-software.com>
    - updated to 0.1.19 and added more installation logging
  * Wed Nov 21 2012 Mark J. Titorenko <mark.titorenko@alces-software.com>
    - add $SAMTOOLSLIB to LD_LIBRARY_PATH
  * Thu Oct 25 2012 Mark J. Titorenko <mark.titorenko@alces-software.com>
    - add missing varfilter.py to bin directory
    - sed hashbang lines for perl and python scripts to use env
  * Wed Oct 10 2012 Mark J. Titorenko <mark.titorenko@alces-software.com>
    - additionally enable shared library build
  * Wed Aug 15 2012 Mark J. Titorenko <mark.titorenko@alces-software.com>
    - updated to 0.1.18
    - refactored to use packager style
  * Thu Jul 14 2011 Steve Norledge
    - updated to 0.1.17
    - added latest link
  * Tue Feb 22 2011 Steve Norledge
    - First created
:src: samtools-0.1.19.tar.bz2
:type: apps
:version: '0.1.19'
:compilers:
  gcc:
:dependencies:
  el:
    - zlib-devel
    - ncurses-devel
:compile: |
  sed -i -e 's|^CFLAGS=.*|CFLAGS= -g -Wall -O2 -fPIC|g' Makefile
  make <%= redirect(:make) %>
  if [ "$(uname -s)" == "Darwin" ]; then
    make libbam.1.dylib-local <%= redirect(:make) %>
    ln -s libbam.1.dylib libbam.dylib
  else
    make libbam.so.1-local <%= redirect(:make) %>
    ln -s libbam.so.1 libbam.so
  fi
  # sed #!s to use env
  for a in misc/*.pl bcftools/*.pl; do
    sed -e 's|#!.*/usr/bin/perl.*|#!/usr/bin/env perl|g' -i $a
  done
  for a in misc/*.py; do
    sed -e 's|#!.*|#!/usr/bin/env python|g' -i $a
  done
:install: |
  mkdir -p <%= dest_dir %>/include <%= dest_dir %>/doc <%= dest_dir %>/lib <%= dest_dir %>/bin <%= dest_dir %>/man/man1
  cp -v AUTHORS COPYING NEWS <%= dest_dir %>/doc <%= redirect(:install) %>
  chmod a+r <%= dest_dir %>/doc/*

  cp -v samtools bcftools/bcftools bcftools/*.pl misc/*.pl misc/maq2sam-long misc/maq2sam-short misc/md5fa misc/md5sum-lite misc/varfilter.py misc/wgsim misc/bamcheck misc/plot-bamcheck <%= dest_dir %>/bin <%= redirect(:install) %>
  chmod a+rx <%= dest_dir %>/bin/*

  cp -v samtools.1 <%= dest_dir %>/man/man1 <%= redirect(:install) %>
  chmod a+r <%= dest_dir %>/man/man1/*

  cp -v *.a <%= dest_dir %>/lib <%= redirect(:install) %>
  shopt -s nullglob
  cp -av *.dylib* *.so* <%= dest_dir %>/lib <%= redirect(:install) %>
  shopt -u nullglob
  cp -v *.h <%= dest_dir %>/include <%= redirect(:install) %>
  chmod a+r <%= dest_dir %>/include/*

  cp -rv examples <%= dest_dir %> <%= redirect(:install) %>
  chmod a+rx <%= dest_dir %>/examples
  chmod -R a+r <%= dest_dir %>/examples/*
:module: |
  setenv ${appcaps}DIR ${appdir}
  setenv ${appcaps}BIN ${appdir}/bin
  setenv ${appcaps}LIB ${appdir}/lib
  setenv ${appcaps}INCLUDE ${appdir}/include
  setenv ${appcaps} ${appdir}/lib/libbam.a

  prepend-path PATH ${appdir}/bin
  prepend-path MANPATH ${appdir}/man
  prepend-path LD_LIBRARY_PATH ${appdir}/lib
:example_scripts:
  - tags: ['script:type=batch']
    name: 'samtools view; convert SAM to BAM'
    description: 'Execute samtools view command to convert a SAM file to a BAM file'
    template: 'script:stub:simple'
    content: |
      #############################################
      # APPLICATION COMMANDS - change as required
      #############################################
      #
      # samtools offers many different commands; this example script demonstrates
      # using the 'view' command to convert a SAM file to a BAM file.
      #
      # For detailed samtools usage information see:
      #   http://samtools.sourceforge.net/samtools.shtml

      # Output directory
      OUTPUT_DIR="samtools/output.${JOB_ID-${PORTAL_TASK_ID-$$}}"

      # Input SAM file
      INPUT_FILE=$SAMTOOLSDIR/examples/toy.sam

      # Output BAM file
      OUTPUT_FILE=$OUTPUT_DIR/toy.bam

      # Additional command-line options (samtools -h for a list)
      SAMTOOLS_OPTIONS="-bS"

      mkdir -p $OUTPUT_DIR
      samtools view $SAMTOOLS_OPTIONS $INPUT_FILE -o $OUTPUT_FILE
